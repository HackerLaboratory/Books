本文整理一些在Web开发中需要特别注意的一些点，比如HTTP的一些特性、浏览器的一些特性、Web框架的一些特性等等

## 浏览器刷新

刷新浏览器的时候，浏览器其实是按照最后一次请求再发起一次相同的请求，比如你发起了一次表单请求（POST），然后刷新，那么浏览器又会向服务端发起一次相同的POST请求，大多数情况下，这并不是理想的处理方法。那么我们怎么来解决这个问题呢？

这种需求的解决方案是：`使用重定向作为POST请求的响应，而不是使用常规响应`。重定向是一种特殊的响应，响应内容是URL，而不是包含HTML代码的字符串。浏览器收到这种响应时，会向重定向的URL发起GET请求，显示页面的内容。这个页面的加载可能要多花几微秒，因为要先把第二个请求发给服务器。除此之外，用户不会察觉到有什么不同。现在，最后一个请求时GET请求，所以刷新命令就能像预期的那样正常使用了。这个技巧称为`POST/重定向/GET模式`

但这种方法会带来另一个问题。程序处理POST请求时，可以得到表单的数据，可是一旦这个请求结束，数据也就丢失了（因为HTTP不是能保持连接状态的协议），因为这个POST请求使用重定向处理，所以程序需要保存输入的名字，这样重定向之后的请求才能获得并使用这个名字，从而构建真正的响应

程序可以把数据存储到`用户会话session`中，在请求之间“记住”数据。用户会话是一种私有存储，存在于每个连接到服务器的客户端中！

## 账户密码的安全性

千万不要把账户密码直接写入脚本！特别是当你计划开源自己的作品时。为了保护账户信息，你需要让脚本从环境变量中导入敏感信息

## 发送邮件的性能问题

使用Flask-Mail发送邮件，mail.send()函数在发送电子邮件的时候停滞了几秒，在这个过程中浏览器就像无响应一样。为了避免处理请求过程中不必要的延迟，可以把发送电子邮件的函数移到后台线程中

不过要记住，程序要发送大量的电子邮件时，使用专门发送电子邮件的作业要比给每封邮件都心间一个线程更合适，因为在操作系统中线程的数量安排为多少还是要严格结合CPU数量、程序的CPU密集程度来做一个合理分配的，并不是越多越好

>发个邮件都涉及到这么多性能、线程的问题，而且到目前做的还只是单个用户的小Web APP，试想当用户量达到上千万，数据量大到一定程度，那么Web APP的难度有多大！所以如果说单纯的实现一个Web APP的功能，那是极其简单的，但是如果要做到大数据、大用户、高并发，这些才是最难的！

>另外还会遇到因为网络环境等问题导致邮件发送失败的情况，还是其他可能的数据丢失的情况，这些异常场景要怎么处理，也是大型系统开发的难点所在！

## 大型程序的结构

尽管在单一脚本中编写小型Web程序很方便，但这种方法并不能广泛使用。程序变复杂后，使用单个大型源码文件会导致很多问题。不同于大多数其他的Web框架，Flask并不强制要求大型项目使用特定的组织方式，程序结构的组织方式完全由开发者决定。这里给出一种可借鉴的结构

```
|-flasky
    |-app/
        |-templates/
        |-static/
        |-main/
            |-__init__.py
            |-errors.py
            |-forms.py
            |-views.py
        |-__init__.py
        |-email.py
        |-models.py
    |-migrations/
    |-tests/
        |-__init__.py
        |-test*.py
    |-requirements.txt
    |-config.py
    |-manage.py
```

程序经常需要设定多个配置，这方面最好的例子就是开发、测试和生产环境使用不同的数据库，这样才不会彼此影响
